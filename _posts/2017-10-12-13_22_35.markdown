---
layout:     post
title:      "How to connect sql database in python"
subtitle:   "use mysql and xxx"
date:       2017-10-12
author:     "Ziping"
header-img: "img/python.jpg"
catalog: true
tags:
    - python
    - mysql
---

This blog is to record my process to connect mysql database in python.

I choose MySQLdb as my tool because it is said that MySQLdb is the most stable way to connect to a MySQL database.

MySQLdb doesnot support Python3 because I got an error:

```python
$ sudo pip install MySQL-python
Collecting MySQL-python
  Downloading http://mirrors.aliyun.com/pypi/packages/a5/e9/51b544da85a36a68debe7a7091f068d802fc515a3a202652828c73453cad/MySQL-python-1.2.5.zip (108kB)
    100% |████████████████████████████████| 112kB 637kB/s 
    Complete output from command python setup.py egg_info:
    sh: mysql_config: command not found
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/tmp/pip-build-TmLXPF/MySQL-python/setup.py", line 17, in <module>
        metadata, options = get_config()
      File "setup_posix.py", line 43, in get_config
        libs = mysql_config("libs_r")
      File "setup_posix.py", line 25, in mysql_config
        raise EnvironmentError("%s not found" % (mysql_config.path,))
    EnvironmentError: mysql_config not found
    
    ----------------------------------------
Command "python setup.py egg_info" failed with error code 1 in /tmp/pip-build-TmLXPF/MySQL-python/
```

The config file missing here is cause by ``ConfigParser`` that has changed in python3.

There is a replacement in Python3, ``pymysql``

```shell
pip install pymysql
```

```Python
#coding=utf-8
 
import pymysql as MySQLdb

host 	= "xxxx"
db 		= "xxxx"
user 	= "xxxx"
port 	= "xxxx"
passwd 	= "xxxx"


class SelectMySQL(object):
    def select_data(self,sql):
        result = []
        try:
            conn = MySQLdb.connect(host=host,
                               port=port,
                               user=user,
                               passwd=passwd,
                               db=db,
                               charset='utf8', )
            cur = conn.cursor()
            cur.execute(sql)
            alldata = cur.fetchall()
            # print(alldata)
            for rec in alldata:
                result.append(rec[0])
        except Exception as e:
            print('Error msg: ' + e)
        finally:
            cur.close()
            conn.close()
  
        return result

    def get_result(self, sql, filename):
        print(sql)
        results = self.select_data(sql)
        print('The amount of datas: %d' % (len(results)))
        with open(filename, 'w') as f:
            for result in results:
                f.write(str(result) + '\n')
        print('Data write is over!')
        return results

if __name__ == '__main__':
    sql = "select name from user"
    select = SelectMySQL()
    result1 = select.get_result(sql,'namemsg.txt')
    print(result1)
```

add your sql command.

## Create Table

[//]: #	"This may be the most platform independent comment"

